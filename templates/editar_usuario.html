{% extends "base_m.html" %}
{% block title %}Alterar Senha e Dados do Advogado{% endblock %}
{% block content %}
<div class="card">
    <div class="card-header"><h2>Alterar senha do usuário</h2></div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('user.editar_usuario', user_id=usuario.id) }}">
            <div class="mb-3">
                <label for="password" class="form-label">Nova Senha</label>
                <input type="password" class="form-control" id="password" name="password" required minlength="6">
            </div>
            <div class="mb-3">
                <label for="password_confirm" class="form-label">Confirme a Nova Senha</label>
                <input type="password" class="form-control" id="password_confirm" name="password_confirm" required minlength="6">
                <small class="form-text text-muted">Digite novamente a nova senha.</small>
            </div>
            <button type="submit" class="btn btn-primary">Alterar senha</button>
        </form>
    </div>
</div>

<!-- INFORMAÇÕES DO USUÁRIO E ADMIN -->
<div class="card mt-4">
    <div class="card-header"><h3>Informações do Usuário</h3></div>
    <div class="card-body">
        <p><strong>Nome de usuário:</strong> {{ usuario.username }}</p>
        <p><strong>E-mail:</strong> {{ usuario.email }}</p>
        <p><strong>Tipo de usuário:</strong> {% if usuario.is_admin %}Administrador{% else %}Associado{% endif %}</p>
        {% if usuario.admin_id and usuario.admin %}
            <p><strong>Admin responsável:</strong> {{ usuario.admin.username }} (ID: {{ usuario.admin_id }})</p>
        {% endif %}
        <hr>
        <h5>Dados do Advogado Vinculado ao Usuário</h5>
        {% if usuario.advogados.count() > 0 %}
            {% for advogado in usuario.advogados %}
                <form method="POST" action="{{ url_for('user.editar_advogado', advogado_id=advogado.id) }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nome_{{ advogado.id }}" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="nome_{{ advogado.id }}" name="nome" value="{{ advogado.nome }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="estado_civil_{{ advogado.id }}" class="form-label">Estado Civil</label>
                            <input type="text" class="form-control" id="estado_civil_{{ advogado.id }}" name="estado_civil" value="{{ advogado.estado_civil }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="profissao_{{ advogado.id }}" class="form-label">Profissão</label>
                            <input type="text" class="form-control" id="profissao_{{ advogado.id }}" name="profissao" value="{{ advogado.profissao }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="cpf_{{ advogado.id }}" class="form-label">CPF</label>
                            <input type="text" class="form-control" id="cpf_{{ advogado.id }}" name="cpf" value="{{ advogado.cpf }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="rg_{{ advogado.id }}" class="form-label">RG</label>
                            <input type="text" class="form-control" id="rg_{{ advogado.id }}" name="rg" value="{{ advogado.rg }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="orgao_emissor_{{ advogado.id }}" class="form-label">Órgão Emissor</label>
                            <input type="text" class="form-control" id="orgao_emissor_{{ advogado.id }}" name="orgao_emissor" value="{{ advogado.orgao_emissor }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="oab_pr_{{ advogado.id }}" class="form-label">OAB PR</label>
                            <input type="text" class="form-control" id="oab_pr_{{ advogado.id }}" name="oab_pr" value="{{ advogado.oab_pr }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="oab_ro_{{ advogado.id }}" class="form-label">OAB RO</label>
                            <input type="text" class="form-control" id="oab_ro_{{ advogado.id }}" name="oab_ro" value="{{ advogado.oab_ro }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="oab_sp_{{ advogado.id }}" class="form-label">OAB SP</label>
                            <input type="text" class="form-control" id="oab_sp_{{ advogado.id }}" name="oab_sp" value="{{ advogado.oab_sp }}">
                        </div>
                        <div class="col-md-12 mb-3">
                            <label for="endereco_profissional_{{ advogado.id }}" class="form-label">Endereço Profissional</label>
                            <input type="text" class="form-control" id="endereco_profissional_{{ advogado.id }}" name="endereco_profissional" value="{{ advogado.endereco_profissional }}">
                        </div>
                        <div class="col-md-12 mb-3">
                            <label for="is_principal_{{ advogado.id }}" class="form-label">Principal</label>
                            <select class="form-control" id="is_principal_{{ advogado.id }}" name="is_principal">
                                <option value="1" {% if advogado.is_principal %}selected{% endif %}>Sim</option>
                                <option value="0" {% if not advogado.is_principal %}selected{% endif %}>Não</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success mb-4">Salvar Advogado</button>
                </form>
                <hr>
            {% endfor %}
        {% else %}
            <p>Não há informações de advogado para este usuário.</p>
        {% endif %}
    </div>
</div>

{% if usuario.is_admin and current_user.id == usuario.id %}
<div class="card mt-4">
    <div class="card-header"><h3>Advogados dos Associados deste Admin</h3></div>
    <div class="card-body">
        {% set associados = usuario.associados.all() %}
        {% if associados|length > 0 %}
            {% for associado in associados %}
                <h5>Associado: {{ associado.username }} (ID: {{ associado.id }})</h5>
                {% if associado.advogados.count() > 0 %}
                    {% for advogado in associado.advogados %}
                        <form method="POST" action="{{ url_for('user.editar_advogado', advogado_id=advogado.id) }}">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nome_{{ advogado.id }}" class="form-label">Nome</label>
                                    <input type="text" class="form-control" id="nome_{{ advogado.id }}" name="nome" value="{{ advogado.nome }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="estado_civil_{{ advogado.id }}" class="form-label">Estado Civil</label>
                                    <input type="text" class="form-control" id="estado_civil_{{ advogado.id }}" name="estado_civil" value="{{ advogado.estado_civil }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="profissao_{{ advogado.id }}" class="form-label">Profissão</label>
                                    <input type="text" class="form-control" id="profissao_{{ advogado.id }}" name="profissao" value="{{ advogado.profissao }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="cpf_{{ advogado.id }}" class="form-label">CPF</label>
                                    <input type="text" class="form-control" id="cpf_{{ advogado.id }}" name="cpf" value="{{ advogado.cpf }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="rg_{{ advogado.id }}" class="form-label">RG</label>
                                    <input type="text" class="form-control" id="rg_{{ advogado.id }}" name="rg" value="{{ advogado.rg }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="orgao_emissor_{{ advogado.id }}" class="form-label">Órgão Emissor</label>
                                    <input type="text" class="form-control" id="orgao_emissor_{{ advogado.id }}" name="orgao_emissor" value="{{ advogado.orgao_emissor }}">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="oab_pr_{{ advogado.id }}" class="form-label">OAB PR</label>
                                    <input type="text" class="form-control" id="oab_pr_{{ advogado.id }}" name="oab_pr" value="{{ advogado.oab_pr }}">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="oab_ro_{{ advogado.id }}" class="form-label">OAB RO</label>
                                    <input type="text" class="form-control" id="oab_ro_{{ advogado.id }}" name="oab_ro" value="{{ advogado.oab_ro }}">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="oab_sp_{{ advogado.id }}" class="form-label">OAB SP</label>
                                    <input type="text" class="form-control" id="oab_sp_{{ advogado.id }}" name="oab_sp" value="{{ advogado.oab_sp }}">
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label for="endereco_profissional_{{ advogado.id }}" class="form-label">Endereço Profissional</label>
                                    <input type="text" class="form-control" id="endereco_profissional_{{ advogado.id }}" name="endereco_profissional" value="{{ advogado.endereco_profissional }}">
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label for="is_principal_{{ advogado.id }}" class="form-label">Principal</label>
                                    <select class="form-control" id="is_principal_{{ advogado.id }}" name="is_principal">
                                        <option value="1" {% if advogado.is_principal %}selected{% endif %}>Sim</option>
                                        <option value="0" {% if not advogado.is_principal %}selected{% endif %}>Não</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success mb-4">Salvar Advogado</button>
                        </form>
                        <hr>
                    {% endfor %}
                {% else %}
                    <p>Não há informações de advogado para este associado.</p>
                {% endif %}
            {% endfor %}
        {% else %}
            <p>Não há associados vinculados a este admin.</p>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}