{% extends "base_m.html" %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/guidelines.css') }}">
    <style>
      .repository-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 28px 24px;
        justify-content: flex-start;
        margin-top: 20px;
      }
      .file-card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.07);
        padding: 0;
        width: 320px;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        transition: box-shadow 0.2s;
        overflow: hidden;
        border: 1px solid #e5e5e5;
      }
      .file-cover-image {
        width: 100%;
        height: 160px;
        object-fit: cover;
        object-position: center;
        background: #fafafa;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        display: block;
      }
      .file-card .file-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 120px;
        background: #f5f5f8;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
      }
      .file-cover {
        position: relative;
      }
      .file-cover .file-icon {
        position: absolute;
        right: 12px;
        bottom: 12px;
        background: rgba(255,255,255,0.89);
        border-radius: 50%;
        padding: 6px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.10);
        z-index: 2;
        width: 38px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .file-info {
        padding: 18px 18px 8px 18px;
        flex: 1 1 auto;
      }
      .file-name {
        font-size: 1.13rem;
        font-weight: bold;
        margin-bottom: 6px;
        margin-top: 0;
      }
      .file-description {
        margin: 0 0 10px 0;
        color: #666;
        font-size: 0.98rem;
      }
      .file-actions {
        padding: 10px 18px 18px 18px;
        display: flex;
        justify-content: flex-end;
      }
      @media (max-width: 600px) {
        .repository-grid {
          flex-direction: column;
          gap: 18px 0;
        }
        .file-card {
          width: 100%;
          min-width: 0;
        }
      }
    </style>
{% endblock %}

{% block content %}
<main class="guideline-container">
    <header class="repository-header">
        <h1>Repositório de Materiais</h1>
        <p>
            Bem-vindo ao nosso centro de documentação. Aqui você encontra manuais, políticas e materiais de orientação essenciais para o dia a dia na Escritório.
        </p>
    </header>

    <section class="repository-grid">
        {% if arquivos and arquivos|length > 0 %}
            {% for arquivo in arquivos %}
            <div class="file-card">
                {% if arquivo.imagem_capa %}
                <div class="file-cover">
                    <img src="{{ url_for('static', filename='uploads/' ~ arquivo.imagem_capa) }}"
                         alt="Imagem de capa de {{ arquivo.nome }}"
                         class="file-cover-image">
                    <div class="file-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                    </div>
                </div>
                {% else %}
                <div class="file-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                </div>
                {% endif %}
                <div class="file-info">
                    <h3 class="file-name">{{ arquivo.nome }}</h3>
                    {% if arquivo.descricao %}
                        <p class="file-description">{{ arquivo.descricao }}</p>
                    {% endif %}
                    <div class="file-meta">
                        {# Exemplo: <span class="file-size">Tamanho: {{ arquivo.tamanho|filesizeformat }}</span> #}
                        {# <span class="upload-date">Adicionado em: {{ arquivo.data_upload|date('d/m/Y') }}</span> #}
                    </div>
                </div>
                <div class="file-actions">
                    <a href="{{ url_for('ferramentas.download_arquivo', arquivo_id=arquivo.id) }}" class="btn btn-primary" download title="Baixar {{ arquivo.nome }}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                        <span>Baixar</span>
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>Nenhum arquivo de orientação foi adicionado ainda.</p>
            </div>
        {% endif %}
    </section>

    {% if usuario_admin %}
    <section class="admin-panel">
        <div class="admin-panel-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.2 15c.7-1.2 1-2.5.7-3.9-.6-2.4-2.4-4.2-4.8-4.8-.7-.2-1.5-.3-2.1-.2-1.9.4-3.5 1.8-4.4 3.4L7.3 12c-.3.4-.4.8-.4 1.3 0 1.1.9 2 2 2h.3c.5 0 1 .2 1.3.4.9 1.6 2.5 3 4.4 3.4.7.2 1.5.2 2.1-.1.8-.4 1.5-1 2-1.8Z"></path><path d="M7 21a2.5 2.5 0 0 1-2.2-1.2c-.6-1.1-.5-2.5.3-3.6C6 15.3 7.5 15 8.7 15h.1c1.1 0 2.1.8 2.2 1.9.1 1.4-.8 2.6-2 3Z"></path></svg>
            <h3>Painel Administrativo</h3>
        </div>
        <form method="POST" enctype="multipart/form-data" action="{{ url_for('ferramentas.upload_arquivo') }}">
            <h4>Adicionar Novo Arquivo</h4>
            <div class="form-group">
                <label for="arquivo">Selecione o arquivo</label>
                <input type="file" id="arquivo" name="arquivo" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="descricao">Descrição (curta, até 100 caracteres)</label>
                <input type="text" id="descricao" name="descricao" class="form-control" maxlength="100" placeholder="Ex: Manual de Boas Práticas">
            </div>
            <div class="form-group">
                <label for="imagem_capa">Imagem de Capa (opcional)</label>
                <input type="file" id="imagem_capa" name="imagem_capa" class="form-control">
            </div>
            <button type="submit" class="btn btn-success">
                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                <span>Fazer Upload</span>
            </button>
        </form>
    </section>
    {% endif %}
</main>
{% endblock %}