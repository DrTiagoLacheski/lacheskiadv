{% extends "base_m.html" %}

{% block title %}Lacheski Advocacia - In√≠cio{% endblock %}

{% block styles %}
    {{ super() }}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index_custom.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <style>
        .header-logo {
            max-width: 350px;
            height: auto;
            margin-bottom: 10px;
        }

        /* Espa√ßamento geral e melhor fluxo no mobile */
        .container {
            max-width: 1080px;
            margin: 0 auto;
            padding: 22px 14px 0 14px;
        }

        .dashboard {
            display: flex;
            flex-wrap: wrap;
            gap: 32px;
            margin-bottom: 24px;
        }

        .date-time-card,
        .appointments-card {
            background: var(--color-card-bg, #f8fafc);
            border-radius: 16px;
            box-shadow: 0 2px 18px rgba(0,0,0,0.09), 0 1.5px 4px rgba(0,0,0,0.07);
            padding: 28px 24px 24px 24px;
            min-width: 340px;
            max-width: 480px;
            flex: 1 1 360px;
            margin: 0 auto 0 auto;
            display: flex;
            flex-direction: column;
        }
        .appointments-card {
            margin-top: 0;
        }

        .main-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 22px;
            margin: 26px 0 0 0;
        }
        .main-option-card {
            border-radius: 14px;
            padding: 24px 18px 18px 18px;
            font-size: 1.04rem;
            box-shadow: 0 2px 14px rgba(0,0,0,0.07), 0 1px 2px rgba(0,0,0,0.06);
        }

        /* -------- MOBILE -------- */
        @media (max-width: 800px) {
            .dashboard {
                flex-direction: column;
                gap: 16px;
            }
            .date-time-card,
            .appointments-card {
                min-width: 0;
                max-width: 100%;
                padding: 18px 7vw 18px 7vw;
                border-radius: 14px;
                margin-bottom: 12px;
            }
            .main-options {
                gap: 14px;
                margin-top: 18px;
            }
        }
        @media (max-width: 600px) {
            .container {
                padding: 3.5vw 0 0 0;
            }
            .dashboard {
                gap: 10px;
                margin-bottom: 12px;
            }
            .date-time-card,
            .appointments-card {
                padding: 16px 2vw 14px 2vw;
                min-width: 0;
                max-width: 100%;
                border-radius: 11px;
                margin-bottom: 10px;
            }
            .main-options {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-top: 13px;
                padding: 0 2vw;
            }
            .main-option-card {
                border-radius: 10px;
                padding: 16px 8px 13px 8px;
                font-size: .98rem;
            }
        }
        @media (max-width: 450px) {
            .container {
                padding: 0 0 0 0;
            }
            .dashboard {
                gap: 7px;
            }
            .date-time-card,
            .appointments-card {
                padding: 10px 0 11px 0;
                border-radius: 7px;
                margin-bottom: 6px;
            }
            .main-options {
                gap: 8px;
                margin-top: 10px;
                padding: 0 1vw;
            }
            .main-option-card {
                padding: 10px 3px 8px 3px;
                font-size: .93rem;
            }
        }

        /* Cards de compromissos - espa√ßamento extra entre eles */
        #appointment-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-top: 6px;
        }
        .appointment-item {
            border-radius: 9px;
            padding: 16px 10px;
            margin: 0;
            font-size: 1.01rem;
        }
        @media (max-width: 640px) {
            #appointment-list {
                gap: 16px;
            }
            .appointment-item {
                font-size: 1.08rem;
                padding: 17px 8px 15px 8px;
                border-radius: 13px;
            }
        }
        @media (max-width: 450px) {
            #appointment-list {
                gap: 12px;
            }
            .appointment-item {
                font-size: 1.02rem;
                padding: 12px 4px 12px 4px;
                border-radius: 8px;
            }
        }
        /* Ajuste para t√≠tulos e bot√µes em cards */
        .calendar-header h3,
        #appointments-title {
            font-size: 1.12rem;
            margin: 0 0 9px 0;
            line-height: 1.28;
        }
        .d-flex.gap-2 {
            gap: 9px !important;
            flex-wrap: wrap;
        }
        .calendar-header,
        .d-flex.justify-content-between {
            flex-direction: column !important;
            align-items: stretch !important;
            gap: 8px !important;
        }
        /* Bot√µes de a√ß√£o maiores para toque */
        .btn,
        .calendar-nav-btn {
            min-width: 40px;
            min-height: 40px;
            font-size: 1.08rem;
            padding: 8px 12px;
            border-radius: 10px;
        }
    </style>
{% endblock %}

{% block content %}
<div class="container">
    {% if mensagem_negada %}
        <div class="alert alert-danger" role="alert" style="margin-top:20px;">
            {{ mensagem_negada }}
        </div>
    {% endif %}

    <header class="header">
        <img src="{{ url_for('static', filename='images/logolacheski.png') }}" alt="Logo Lacheski Advocacia" class="header-logo">
        <p style="font-size:1.04rem">Portal de Ferramentas e Gerenciamento</p>
    </header>

    <div class="dashboard">
        <div class="date-time-card">
            <div class="calendar-header">
                <button id="prev-month-btn" class="calendar-nav-btn" aria-label="M√™s anterior" type="button">&lt;</button>
                <h3 id="month-year" aria-live="polite"></h3>
                <button id="next-month-btn" class="calendar-nav-btn" aria-label="Pr√≥ximo m√™s" type="button">&gt;</button>
            </div>
            <div class="calendar-weekdays" aria-hidden="true">
                <div>D</div><div>S</div><div>T</div><div>Q</div><div>Q</div><div>S</div><div>S</div>
            </div>
            <div class="calendar-days" id="calendar-days" role="grid" aria-label="Calend√°rio mensal">
                <!-- C√©lulas geradas via JS com data-attributes -->
            </div>
        </div>

        <div class="appointments-card" id="appointments-card">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <h3 id="appointments-title" aria-live="polite" class="m-0">Compromissos do Dia</h3>
                <div class="d-flex flex-wrap gap-2">
                    <button id="delete-all-btn" class="btn btn-danger btn-sm edit-only" type="button">
                        <i class="bi bi-trash3-fill"></i> Excluir Todos
                    </button>
                    <button id="export-calendar-btn" class="btn btn-outline-success btn-sm edit-only" type="button">
                        <i class="fa-solid fa-calendar-arrow-down"></i> Exportar
                    </button>
                    <form id="importCalendarForm" method="POST"
                          action="{{ url_for('calendar_export_import.import_calendar_appointments') }}"
                          enctype="multipart/form-data" style="display:inline;">
                        <input type="file" id="importCalendarInput" name="calendar_zip" accept=".zip"
                               style="display: none;" required>
                        <button class="btn btn-outline-primary btn-sm edit-only" type="button"
                                id="import-calendar-btn">
                            <i class="fa-solid fa-calendar-arrow-up"></i> Importar
                        </button>
                    </form>
                    <button id="add-appointment-btn" class="btn btn-primary btn-sm rounded-circle"
                            data-bs-toggle="modal" data-bs-target="#appointmentModal" aria-label="Adicionar compromisso" type="button">
                        <i class="bi bi-plus-lg"></i>
                    </button>
                    <button id="toggle-edit-mode-btn" class="btn btn-outline-secondary btn-sm rounded-circle" aria-label="Alternar modo de edi√ß√£o" type="button">
                        <i class="bi bi-gear-fill"></i>
                    </button>
                </div>
            </div>
            <div id="appointment-list" aria-live="polite">
                <!-- Conte√∫do renderizado dinamicamente -->
            </div>
        </div>
    </div>

    <div class="main-options">
        <a href="{{ url_for('ferramentas.index') }}" class="main-option-card">
            <div class="option-icon">‚öñÔ∏è</div>
            <h3>Ferramentas Jur√≠dicas</h3>
            <p>Acesse todas as ferramentas automatizadas</p>
        </a>
        <a href="{{ url_for('dashboard.dashboard') }}" class="main-option-card">
            <div class="option-icon">üìã</div>
            <h3>Gerenciamento de Triagem</h3>
            <p>Controle de casos e clientes</p>
        </a>
        <a href="{{ url_for('main.painel_gerenciador') }}" class="main-option-card">
            <div class="option-icon">üìö</div>
            <h3>Guidelines</h3>
            <p>Procedimentos e modelos documentais</p>
        </a>
        <a href="{{ url_for('main.financeiro') }}" class="main-option-card finance-card">
            <div class="option-icon">üí∞</div>
            <h3>Finan√ßas do Escrit√≥rio</h3>
            <p>Controle de fluxo de caixa e finan√ßas</p>
        </a>
        <a href="{{ url_for('ferramentas.pagina_ferramentas_pdf') }}" class="main-option-card pdf-tools-card">
            <div class="option-icon"><i class="fas fa-file-pdf"></i></div>
            <h3>Manipulador de PDF</h3>
            <p>Compress√£o, divis√£o, jun√ß√£o e convers√£o de PDFs</p>
        </a>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="appointmentModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Adicionar Compromisso</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
          <form id="appointment-form">
              <input type="hidden" id="appointment-id">
              <div class="mb-3">
                  <label for="appointment-time" class="form-label">Hor√°rio (HH:MM)</label>
                  <input type="time" class="form-control" id="appointment-time" required>
              </div>
              <div class="mb-3">
                  <label for="appointment-content" class="form-label">Descri√ß√£o</label>
                  <textarea class="form-control" id="appointment-content" rows="3" required></textarea>
              </div>
              <div class="mb-3">
                  <label for="appointment-priority" class="form-label">Prioridade</label>
                  <select class="form-select" id="appointment-priority">
                      <option value="Normal" selected>Normal</option>
                      <option value="Importante">Importante</option>
                      <option value="Urgente">Urgente</option>
                  </select>
              </div>
              <div class="mb-3 form-check">
                  <input type="checkbox" class="form-check-input" id="appointment-recurring">
                  <label class="form-check-label" for="appointment-recurring">Repetir mensalmente</label>
              </div>
          </form>
      </div>
      <div class="modal-footer justify-content-between">
        <button type="button" class="btn btn-danger" id="delete-appointment-modal-btn">Excluir</button>
        <div>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="save-appointment-btn">Salvar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="footer" style="padding-bottom:55px;padding-top:18px;">
    <p style="font-size:.98rem;">¬© 2025 Lacheski Advocacia - Todos os direitos reservados</p>
</footer>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    <script>
        // Verificar prefer√™ncia de redu√ß√£o de movimento (acessibilidade)
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            document.body.setAttribute('data-disable-animations', 'true');
        }

        function toggleAnimations() {
            const currentState = document.body.getAttribute('data-disable-animations') === 'true';
            document.body.setAttribute('data-disable-animations', (!currentState).toString());
            localStorage.setItem('disable-animations', (!currentState).toString());
        }

        const savedPreference = localStorage.getItem('disable-animations');
        if (savedPreference !== null) {
            document.body.setAttribute('data-disable-animations', savedPreference);
        }

        // Modo escuro - verificar prefer√™ncia do sistema
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            if (!localStorage.getItem('theme')) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }

        function toggleDarkMode() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
        }
    </script>
{% endblock %}